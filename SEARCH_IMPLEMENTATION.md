# Реализация системы поиска

## Обзор

Реализована полнофункциональная система поиска с автозаполнением для портала Smart Home 2026. Система поддерживает поиск по товарам, статьям, новостям и рейтингам с интеллектуальными предложениями и историей поиска.

## Основные компоненты

### 1. SearchBar (`/src/components/search/SearchBar.tsx`)
- Компонент строки поиска с автозаполнением
- Поддержка популярных запросов и истории поиска
- Интеллектуальные предложения в реальном времени
- Дебаунсинг для оптимизации производительности

### 2. SearchResults (`/src/components/search/SearchResults.tsx`)
- Компонент отображения результатов поиска
- Группировка по типам контента
- Выделение найденных терминов
- Сортировка по релевантности

### 3. Search Page (`/src/pages/Search.tsx`)
- Полноценная страница поиска
- Интеграция с URL параметрами
- Поддержка прямых ссылок на поиск

## Утилиты поиска (`/src/lib/searchUtils.ts`)

### Основные функции:
- `normalizeText()` - нормализация текста для поиска
- `highlightText()` - выделение найденных терминов
- `calculateRelevance()` - вычисление релевантности
- `searchProducts()` - поиск по товарам
- `searchArticles()` - поиск по статьям
- `searchNews()` - поиск по новостям
- `searchRatings()` - поиск по рейтингам
- `generateSuggestions()` - генерация предложений автозаполнения
- `saveSearchToHistory()` - сохранение в историю поиска
- `getSearchHistory()` - получение истории поиска

## Типы данных (`/src/types/search.ts`)

### Основные интерфейсы:
- `SearchResult` - результат поиска
- `SearchSuggestion` - предложение автозаполнения
- `SearchFilters` - фильтры поиска
- `SearchHistory` - история поиска
- `SearchAnalytics` - аналитика поиска

## Интеграция

### В навигации (`/src/components/ui/navbar.tsx`)
- Кнопка поиска в десктопной версии
- Встроенная строка поиска в мобильной версии
- Выпадающий поиск с предложениями

### На главной странице (`/src/components/sections/HeroSection.tsx`)
- Центральная строка поиска в hero секции
- Популярные запросы и предложения

### Маршрутизация (`/src/App.tsx`)
- Добавлен маршрут `/search` для страницы поиска
- Поддержка URL параметров `?q=запрос`

## Функциональность

### 1. Автозаполнение
- Предложения из истории поиска
- Предложения товаров по названию и бренду
- Предложения категорий и брендов
- Популярные поисковые запросы

### 2. Поиск по типам контента
- **Товары**: поиск по названию, бренду, описанию, тегам
- **Статьи**: поиск по заголовку, содержанию, тегам, категории
- **Новости**: поиск по заголовку, содержанию, категории
- **Рейтинги**: поиск по названию, описанию, категории

### 3. Релевантность
- Точные совпадения получают высший приоритет
- Совпадения в начале текста получают бонус
- Учитывается частота вхождений
- Разные веса для заголовков, описаний и тегов

### 4. История поиска
- Автоматическое сохранение в localStorage
- Ограничение до 100 последних запросов
- Отображение количества результатов
- Возможность очистки истории

### 5. Выделение терминов
- Подсветка найденных слов в результатах
- Поддержка множественных терминов
- HTML-разметка с тегом `<mark>`

## Тестирование

### Unit тесты (`/src/components/search/__tests__/search-functionality.test.ts`)
- Тестирование нормализации текста
- Тестирование выделения терминов
- Тестирование вычисления релевантности
- Тестирование поиска по всем типам контента
- Тестирование генерации предложений
- Тестирование истории поиска
- Интеграционные тесты

### Покрытие
- 25 тестов покрывают основную функциональность
- Тестирование граничных случаев
- Проверка обработки ошибок

## Производительность

### Оптимизации
- Дебаунсинг запросов (300мс)
- Ограничение количества предложений (8 шт.)
- Ограничение истории поиска (100 записей)
- Ленивая загрузка результатов

### Кеширование
- История поиска в localStorage
- Популярные запросы кешируются
- Предложения генерируются динамически

## Использование

### Базовое использование SearchBar:
```tsx
import { SearchBar } from '@/components/search/SearchBar';

<SearchBar
  onSearch={(results, query) => {
    // Обработка результатов поиска
  }}
  onSuggestionClick={(suggestion) => {
    // Обработка клика по предложению
  }}
  placeholder="Поиск..."
  showPopular={true}
/>
```

### Отображение результатов:
```tsx
import { SearchResults } from '@/components/search/SearchResults';

<SearchResults
  results={searchResults}
  query={searchQuery}
  onResultClick={(result) => {
    // Обработка клика по результату
  }}
/>
```

## Требования

Реализация покрывает следующие требования из спецификации:
- **8.1**: Поиск с автозаполнением ✅
- **8.2**: Релевантные результаты из статей и устройств ✅
- **8.3**: Поиск по названиям, брендам и категориям ✅
- **8.4**: Выделение найденных терминов ✅
- **8.5**: История популярных запросов ✅

## Будущие улучшения

1. **Фильтрация результатов** - добавление фильтров по типу, дате, цене
2. **Поиск с опечатками** - нечеткий поиск и исправление опечаток
3. **Голосовой поиск** - интеграция с Web Speech API
4. **Аналитика поиска** - детальная аналитика запросов и кликов
5. **Персонализация** - персонализированные предложения
6. **Полнотекстовый поиск** - интеграция с Elasticsearch или подобными решениями